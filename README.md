# ihome

爱家租房python3

## 项目需求

1. 用户模块
    - 注册
      - [x] 用户账号默认为手机号
      - [x] 图片验证码正确后才能发送短信验证码
      - [x] 短信验证码每60秒可发送一次（redis缓存有效期 + celery异步发送短信）
      - [x] 每个条件出错时有相应错误提示
    - 登录
      - [x] 用手机号与密码登陆
      - [x] 错误时有相应提示
    - 登出
      - [x] 用户退出，清除session（此处由于CSRFProtect从session或获取csrf_token，所以退出时需要保留session中的csrf_token）
    - 实名认证
      - [x] 实名认证只可进行一次
      - [x] 提交认证信息后再次进入只能查看信息，不能修改
      - [x] 认证信息包含姓名与身份证号
    - 个人信息修改
      - [x] 可以修改个人头像
      - [x] 可以修改用户名
      - [x] 登陆手机号不能修改
      - [x] 上传头像与用户名分开保存
      - [x] 上传新头像后页面理解显示新头像
    - 我的爱家
      - [x] 显示个人头像、手机号、用户名（用户名未设置时为用户手机号）
      - [x] 提供修改个人信息的入口
      - [x] 提供作为房客下单的查询入口
      - [x] 提供成为房东所需实名认证的入口
      - [x] 提供作为房东发布房屋信息的入口
      - [x] 提供作为房东查询客户订单的入口
      - [x] 提供退出的入口
2. 房源模块
    - 主页
      - [x] 最多5个房屋logo图片展示，点击可跳转至房屋详情页面
      - [x] 提供登陆/注册入口，登陆后显示用户名，点击可跳转至个人中心
      - [x] 用户可以选择城区、入住时间、离开时间等条件进行搜索
      - [x] 城区的区域信息需动态加载
      - [x] 最多5个房屋logo图片展示，点击可跳转至房屋详情页面
      - [x] 提供登陆/注册入口，登陆后显示用户名，点击可跳转至个人中心
      - [x] 用户可以选择城区、入住时间、离开时间等条件进行搜索
      - [x] 城区的区域信息需动态加载
    - 发布房源
      - [x] 需要用户填写全部房屋信息
      - [x] 房屋的文字信息与图片分开操作
    - 我的房源（显示用户房源）
      - [x] 未实名认证的用户不能发布新房源信息，需引导到实名认证页面
      - [x] 按时间倒序显示已经发布的房屋信息
      - [x] 点击房屋可以进入详情页面
      - [x] 对实名认证的用户提供发布新房屋的入口
    - 房屋列表
      - [x] 可根据入住离开时间、区域进行筛选，并可进行排序
      - [x] 房屋信息分页加载
      - [x] 区域信息动态加载
      - [x] 筛选条件更新后，页面立即刷新
    - 房屋详情
      - [x] 需展示的详细信息参考设计图
      - [x] 提供预定入口
      - [x] 若是房东本人查看房屋信息时，预定入口不显示
    - 房屋预订
      - [x] 由用户确定入住时间
      - [x] 根据用户确定的入住离开时间实时显示合计天数与总金额
      - [x] 房东不可预订自己房源
3. 订单模块

    - 我的订单（房客角色）
      - [x] 按时间倒序显示订单信息
      - [x] 订单完成后提供评价功能
      - [x] 已评价的订单能看到评价信息
      - [x] 被拒绝的订单能看到拒单原因
    - 客户订单（房东角色）
      - [x] 按时间倒序显示用户下的订单
      - [x] 对于新订单提供接单与拒单的功能
      - [x] 拒单必须填写拒单原因
      - [x] 若客户进行了订单评价，需显示
4. 支付模块
    - 接入支付宝支付平台
      - [x] 用户点击支付后跳转到支付宝支付页面（有app的直接打开app）
      - [x] 支付完成后，回到订单页面，并更改订单状态

## 项目结构

```python
ihome                   # 总项目目录
├── README.md
├── config.py           # 项目配置文件
├── ihome               # 业务文件包， 包含项目的业务黛安
│   ├── __init__.py
│   ├── blueprints          # 蓝图
│   │   ├── __init__.py
│   │   └── view.py         # 蓝图视图
│   ├── db.py               # 数据库配置
│   ├── libs                # 不通过pip，额外导入的工具文件
│   ├── models.py           # 模型
│   ├── static              # 静态文件夹
│   └── utils               # 自定义的工具文件夹
├── manage.py               # 包装的利用命令行启动项目的文件
└── setup.py                # 部署文件
```

## 相关技术

- 主题框架使用flask框架，前后端分离的设计模式
- mysql数据库，利用flask-sqlalchemy插件链接
- 利用flask-script插件进行命令行操作， flask-migrate进行数据库迁移
    1. python mnange.py runserver 启动程序
    2. python manage.py db migrate -m '生成迁移文件'
    3. python manage.py db upgrade 迁移数据库
- 利用flask-session + redis 进行session管理
- 利用 falsk-wtf 进行 csrf 保护
- 支付模块接入支付宝开放平台进行支付, 使用 python-alipay-sdk 包
- 用户上传的图片和文件托管到 ***七牛云***
- 用户发送短信验证码使用 ***容联云平台***
- 发送短信验证码使用 celery 异步

## 简要开发步骤

1. 分析项目需求
2. 搭建项目文件目录结构
3. 进行数据库设计
4. 编写静态文件蓝图
5. 用户模块
6. 房屋模块
7. 订单模块
8. 支付模块
9. 项目优化

## 新环境中运行步骤

1. 运行 `pip install -r requirements.txt` 安装需要的python包

2. 安装 mysql 和 redis 数据库，并在mysql中创建ihome数据库

3. 修改项目中数据库配置文件

   ![image-20191031192549727](https://tva1.sinaimg.cn/large/006y8mN6gy1g8hluobhdwj31bw0q6nhh.jpg)

4. 使用 `python manage.py db migrate -m '生成数据库迁移文件'`

5. 使用 ` python manage.py db upgrade` 迁移数据库

6. 启动 redis 服务 `redis-server /etc/redis.conf`

7. 启动项目 `py manage.py runserver`